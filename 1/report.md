# Архитектурный ката DingDong: Отчет по сбору и анализу требований

## Отсев требований
**Приоритеты (на основе бэклога):**
1. **Обязательные:**  
   - Уведомление о нажатии кнопки.  
   - Стриминг аудио/видео после подтверждения звонка.  
   - Обнаружение движения и запись видео.  
   - Переключение в режим Wi-Fi точки доступа для настройки.  

2. **Опциональные:**  
   - Удаленная активация сигнализации.  
   - Смена пароля через Wi-Fi.  

**Исключено:**  
- Функции, требующие сложной обработки на устройстве (например, локальный AI для распознавания лиц).

---

## Уточнение объема (Scope Refinement)
| Компонент             | Ответственность                                                                 |
|-----------------------|---------------------------------------------------------------------------------|
| Устройство DingDong   | Сбор данных (видео, аудио), Wi-Fi подключение, локальное хранение звуков.       |
| Облачный сервис       | Обработка видео (детекция движения), хранение записей, маршрутизация уведомлений. |
| Мобильное приложение  | Уведомления, управление настройками, просмотр стримов, активация сигнализации.  |

---

## Функциональные требования
1. **Основные сценарии:**  
   - Уведомление о нажатии кнопки с возможностью ответа через приложение.  
   - Двусторонняя аудиосвязь и видеостриминг в реальном времени.  
   - Автоматическая запись при обнаружении движения.  

2. **Настройка устройства:**  
   - Подключение к Wi-Fi через временную точку доступа.  
   - Смена пароля через приложение.  

3. **Безопасность:**  
   - Шифрование данных (TLS для стримов, AES для хранения).  

---

## Нефункциональные требования
- **Производительность:**  
  - Задержка аудио/видео ≤ 500 мс.  
  - Доступность сервиса: 99.9%.  

- **Безопасность:**  
  - Аутентификация по OAuth2.0.  
  - Хранение видео только на серверах в РФ.  

- **Масштабируемость:**  
  - Поддержка до 100 тыс. устройств (пиковая нагрузка: 20 Гбит/с для видео).  

---

## Ограничения
- **Аппаратные:**  
  - ОЗУ устройства ≤ 512 МБ, ПЗУ ≤ 4 ГБ.  
  - Кнопка активируется только тонким предметом (игла).  

- **Юридические (РФ, 2025):**  
  - Соответствие ФЗ-152 (персональные данные).  
  - Использование российских облачных провайдеров (Yandex Cloud, SberCloud).  

---

## Расчет нагрузки
1. **Трафик:**  
   - Видео (720p, H.264): 1.5 Мбит/с на устройство.  
   - 10 тыс. устройств → 15 Гбит/с (пиковая).  

2. **Хранение:**  
   - Запись при движении (5 событий/день на устройство, 1 мин. → 15 МБ/событие).  
   - 10 тыс. устройств → 750 ГБ/день.  

3. **База данных:**  
   - Метаданные (время, геолокация, ID устройства): 1 КБ/событие.  
   - 50 млн событий/месяц → 50 ГБ/месяц.  

---

**Итог:**  
Система требует распределенной архитектуры с использованием микросервисов для обработки видео, шардированной БД и CDN для стримов. Ключевые риски — соблюдение законодательства РФ и обеспечение низкой задержки при высокой нагрузке.
